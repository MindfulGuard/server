POSTGRES_PASSWORD = 12345678
POSTGRES_PASSWORD_USER = user1
POSTGRES_PASSWORD_PASSWORD = 123456

PROJECT-NAME = mindfulguard
VENV = $(PROJECT-NAME)-build-venv
PYTHON_VERSION = 3.10
DOCKER_WORK_DIR = docker

#docker
CONTAINER_NAME = docker-postgresql-1
DATABASE_USER = mindfulguard
DATABASE_NAME = mindfulguard_production
PATH-TO-DUMP = $(DOCKER_WORK_DIR)/dumps/pgsql.sql
DOCKER_COMPOSE_YML = $(DOCKER_WORK_DIR)/docker-compose.yml

ifeq ($(OS),Windows_NT)
    RM = rmdir /s /q

	PATH_TO_PYTHON_VENV = $(VENV)\Scripts\python.exe

	RUN = py -$(PYTHON_VERSION) build\__main__.py --POSTGRES_PASSWORD $(POSTGRES_PASSWORD) --POSTGRES_PASSWORD_USER $(POSTGRES_PASSWORD_USER) --POSTGRES_PASSWORD_PASSWORD $(POSTGRES_PASSWORD_PASSWORD)
	SETUP-VENV = py -$(PYTHON_VERSION) -m venv $(VENV)
	RUN-VENV = $(ACTIVATE-VENV-MSG) .\$(VENV)\Scripts\activate
else
    RM = rm -rf

	#it will need to be completed
	PATH_TO_PYTHON_VENV = $(VENV)/

	RUN = python$(PYTHON_VERSION) build/__main__.py --POSTGRES_PASSWORD $(POSTGRES_PASSWORD) --POSTGRES_PASSWORD_USER $(POSTGRES_PASSWORD_USER) --POSTGRES_PASSWORD_PASSWORD $(POSTGRES_PASSWORD_PASSWORD)
	SETUP-VENV = python$(PYTHON_VERSION) -m venv $(VENV)
	RUN-VENV = $(ACTIVATE-VENV-MSG) "source $(VENV)/bin/activate"
endif

init:
	docker-compose -f $(DOCKER_COMPOSE_YML) up -d

database-dump:
	docker exec -t $(CONTAINER_NAME) pg_dump -U $(DATABASE_USER) $(DATABASE_NAME) > $(PATH-TO-DUMP)